# 긴 대화를 위한 자동 목차

## 개요
`긴 대화를 위한 자동 목차`는 ChatGPT와 같은 장문의 채팅 UI에 자동으로 ToC(목차)를 생성하여 빠르게 특정 섹션으로 이동하고, 활성 영역을 스크롤하면서 추적할 수 있도록 도와줍니다.

## 특징
- 메시지 내부의 Markdown 제목(#, bold) 또는 구분선을 분석하여 섹션을 추출하고, 제목이 없는 경우 첫번째 의미 있는 문장을 최대 60자까지 잘라서 사용합니다.
- 사용자/어시스턴트 역할 배지를 표시하고, 메시지 번호처럼 보이는 위치를 보여줍니다.
- 오른쪽에 고정된 패널을 제공하며, 패널 내에서 검색, `맨 위로` 버튼, 현재 섹션 강조, 부드러운 스크롤을 지원합니다.
- 화면 우측 하단의 토글 버튼 또는 Alt+T 단축키로 패널을 필터링/접기/열 수 있습니다.
- MutationObserver로 새로운 메시지가 도착하면 ToC를 자동 갱신하고, 300ms debounce로 과도한 렌더링을 방지합니다.
- 모든 처리와 데이터는 로컬에서 수행되며 외부 네트워크 호출이나 애널리틱스는 없습니다.

## 설치 (Chrome/Edge)
1. 이 디렉터리를 압축 해제하거나 `chrome://extensions`에서 "압축해제된 확장 프로그램"을 클릭합니다.
2. `chat-toc-extension` 폴더를 선택하여 로드합니다.
3. 장문의 채팅 페이지를 방문하면 우측 하단의 `목차` 버튼이 표시됩니다.

## 옵션 페이지
- **패널 위치**: 좌측/우측 선택.
- **자동 열기**: 메시지 수 기준으로 긴 스레드에서 자동으로 ToC를 펼칩니다.
- **하이라이트 색상**: 섹션 강조 테두리 색상을 변경합니다.
- **Alt+T 단축키**: 토글 버튼을 키보드로 제어합니다 (기본 설정). 옵션에는 단축키 설명이 표시됩니다.
- **목차 복사 버튼**: 가장 최근 ToC 항목을 텍스트로 클립보드에 복사합니다 (content script에서 백그라운드로 전달된 캐시 기반).

## 개발/정책 메모
- Manifest V3를 사용하며 `content_script.js`가 모든 페이지에 주입되어 ToC를 감지합니다.
- background service worker는 키보드 명령을 받아 현재 탭으로 `togglePanel` 메시지를 전달하고, ToC 데이터를 캐싱해 옵션에서 복사할 수 있게 합니다.
- 설정은 모두 `chrome.storage.sync`에 보존됩니다.
- 네트워크 요청은 전혀 만들지 않으며, 모든 정보는 클라이언트에서 처리됩니다.

## 검증 방법
1. 장문의 채팅(예: ChatGPT 대화)을 열어 우측 하단 토글 버튼이 보이는지 확인합니다.
2. ToC 패널이 등장하고 섹션 제목+배지가 나열되는지 확인합니다.
3. 항목을 클릭하면 부드럽게 해당 메시지로 이동하며, 노란색 하이라이트가 잠깐 표시되는지 확인합니다.
4. 새로운 메시지가 도착하면 MutationObserver가 ToC를 자동 갱신합니다.
5. Alt+T 단축키나 토글 버튼, 검색 상자, "맨 위로"가 정상 동작하는지 확인합니다.
6. 옵션 페이지에서 설정 변경(패널 위치, 자동 열기 임계값, 색상) 후 내용을 재로딩하여 반영되는지 확인합니다.

## Firefox 대응 참고
Manifest V3를 지원하지 않는 Firefox에서는 MV2 스타일의 `background`/`permissions` 수정이 필요합니다. 컨텐츠 스크립트는 동일하게 작동하므로 Manifest를 하이브리드 형식으로 조정하면 기본 기능을 이용할 수 있습니다.
